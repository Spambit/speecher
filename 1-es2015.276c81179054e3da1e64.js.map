{"version":3,"sources":["webpack:///src/app/services/login.service.ts","webpack:///src/app/components/speecher-nav/speecher-nav.component.html","webpack:///src/app/components/speecher-nav/speecher-nav.component.ts","webpack:///src/app/utils/object.util.ts","webpack:///src/app/utils/index.ts","webpack:///src/app/services/drive.service.ts","webpack:///src/app/conf/conf.drive.keys.ts"],"names":["LoginService","login$","this","loadGoogleApi","scope","apiKey","clientId","discoveryDocs","gapi","client","init","then","googleAuth","auth2","getAuthInstance","isSignedIn","listen","updateSigninStatus","e","Promise","reject","isLoggedIn","console","log","next","script","document","createElement","addEventListener","googleApiDidLoad","setAttribute","body","appendChild","forScope","currentUser","get","hasGrantedScopes","user","getBasicProfile","avatar","getImageUrl","name","getName","email","getEmail","shortName","getFamilyName","load","msg","error","key","initClient","_","builder","SigninOptionsBuilder","setPrompt","setScope","signIn","catch","throwDeferedError","signOut","config","SpeecherNavComponent","header","button","simple","show","dropdown","createInstanceOfClass","c","attrValues","obj","keys","Object","defer","fn","window","setTimeout","DriveService","loginService","loginOptions","resolve","loadGoogleDrive","findFile","found","IDs","length","createFolderInternal","id","folderId","callback","retrievePageOfChildren","request","result","execute","resp","concat","files","nextPageToken","drive","list","q","pageToken","fields","initialRequest","spaces","fileId","alt","content","defaultFolderName","folder","allFilesInFolder","query","res","map","file","fileIds","loadApi","login","pipe","first","subscribe","loggedIn","fileMetadata","mimeType","folderColorRgb","create","resource","response","status","logout","withContent","createFileWithJSONContent","data","JSON","stringify","update","val","parentFolderId","delimiter","metadata","parents","multipartRequestBody","path","method","params","uploadType","headers"],"mappings":"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","file":"x","sourcesContent":["import * as Utils from '../utils';\nimport { Injectable } from '@angular/core';\nimport { Observable, Subject } from 'rxjs';\n\ndeclare var gapi: any;\n\n@Injectable({ providedIn: 'root' })\nexport class LoginService {\n  readonly login$: Subject<boolean> = new Subject();\n  private googleAuth: any;\n  constructor() {\n    this.loadGoogleApi();\n  }\n\n  private initClient({\n    scope = '',\n    apiKey = '',\n    clientId = '',\n    discoveryDocs = ([] = ['']),\n  }): Promise<any> {\n    if (!gapi) {\n      return Promise.reject('Google Api not available.');\n    }\n\n    return gapi.client\n      .init({\n        apiKey,\n        clientId,\n        scope,\n        discoveryDocs,\n      })\n      .then(\n        () => {\n          this.googleAuth = gapi.auth2.getAuthInstance();\n          // Listen for sign-in state changes.\n          this.googleAuth.isSignedIn.listen((isSignedIn) =>\n            this.updateSigninStatus(isSignedIn)\n          );\n        },\n        (e) => Promise.reject(e)\n      );\n  }\n\n  private updateSigninStatus(isLoggedIn: boolean) {\n    console.log(`Logged in : ${isLoggedIn}`);\n    this.login$.next(isLoggedIn);\n  }\n\n  private loadGoogleApi() {\n    const gapiUrl = 'https://apis.google.com/js/api.js';\n    const script = document.createElement('script');\n    script.addEventListener('load', () => this.googleApiDidLoad());\n    script.setAttribute('src', gapiUrl);\n    document.body.appendChild(script);\n  }\n\n  isLoggedIn({ forScope = '' }): boolean {\n    if (!this.googleAuth) {\n      return false;\n    }\n    const user = this.googleAuth.currentUser.get();\n    return user.hasGrantedScopes(forScope);\n  }\n\n  getUserInfo(): { avatar: string, name: string, email: string, shortName: string } {\n    if (!this.googleAuth || !this.googleAuth.currentUser) {\n      return;\n    }\n    const user = this.googleAuth.currentUser.get().getBasicProfile();\n    return {\n      avatar: user.getImageUrl(),\n      name: user.getName(),\n      email: user.getEmail(),\n      shortName: user.getFamilyName()\n    };\n  }\n\n  private googleApiDidLoad() {\n    gapi.load('client:auth2', () => {\n      console.log('Google auth loaded.');\n    });\n  }\n\n  private throwDeferedError(msg: string): void {\n    Utils.defer(() => {\n      this.login$.error(msg);\n    });\n  }\n\n  public login({\n    scope = '',\n    key = '',\n    clientId = '',\n    discoveryDocs = ([] = ['']),\n  }): Observable<boolean> {\n    this.initClient({ scope, apiKey: key, clientId, discoveryDocs })\n      .then((_) => {\n        if (this.googleAuth.isSignedIn.get()) {\n          this.login$.next(true);\n        } else {\n          const builder = new gapi.auth2.SigninOptionsBuilder();\n          builder.setPrompt('select_account');\n          builder.setScope('profile').setScope('email');\n          this.googleAuth.signIn(builder).catch((e) => {\n            this.throwDeferedError(e);\n          });\n        }\n      })\n      .catch((e) => {\n        this.login$.error(e);\n      });\n    return this.login$;\n  }\n  public logout(): Observable<boolean> {\n    if (!this.googleAuth) {\n      this.throwDeferedError('Google Auth was not loaded.');\n    } else if (!this.googleAuth.isSignedIn.get()) {\n      Utils.defer(() => this.login$.next(false));\n    } else {\n      this.googleAuth.signOut().catch((e) => {\n        this.throwDeferedError('logout failed');\n      });\n    }\n    return this.login$;\n  }\n}\n","<div class='speecher-nav'>\n  <small>{{config.header}}</small>\n  <ng-template [ngIf]=\"config.button.dropdown\" [ngIfElse]=\"simple\">\n    <div ngbDropdown container=\"body\">\n      <button type=\"button\" ngbDropdownToggle class=\"btn bg-transparent\" data-toggle=\"dropdown\">\n        {{config.button.dropdownTitle}}\n      </button>\n      <div ngbDropdownMenu>\n        <ul class=\"list-group list-group-flush\">\n          <li *ngFor=\"let dropdownItem of config.button.dropdownItems\" ngbDropdownItem\n            class=\"list-group-item list-group-item-action text-center\"\n            (click)=\"dropdownItem.click($event, dropdownItem)\">{{dropdownItem.text}}\n          </li>\n        </ul>\n      </div>\n    </div>\n  </ng-template>\n  <ng-template #simple>\n    <button *ngIf='config.button.simple.show' type=\"button\" class=\"btn bg-transparent\"\n      (click)='config.button.simple.click($event)'>\n      <fa-icon [style.color]=\"config.button.simple.iconColor\" [icon]=\"config.button.simple.icon\"></fa-icon>\n    </button>\n  </ng-template>\n</div>\n","import { Component, Input, OnInit } from '@angular/core';\nimport { IconDefinition } from '@fortawesome/fontawesome-svg-core';\n\n@Component({\n  selector: 'speecher-nav',\n  templateUrl: 'speecher-nav.component.html',\n  styleUrls: ['speecher-nav.component.scss'],\n})\nexport class SpeecherNavComponent implements OnInit {\n  constructor() {}\n  @Input() config?: NavConfig = {\n    header: '',\n    button: { simple: { show: false }, dropdown: false },\n  };\n  ngOnInit() {}\n}\n\nexport interface NavConfig {\n  button?: {\n    simple?: {\n      iconColor?: string;\n      show: boolean;\n      icon?: IconDefinition;\n      click?: (e: Event) => void;\n    };\n    dropdownTitle?: string;\n    dropdown?: boolean;\n    dropdownItems?: NavDropDownItem[];\n  };\n  header?: string;\n}\n\nexport interface NavDropDownItem {\n  click?: (e: Event, item: NavDropDownItem) => void;\n  text?: string;\n}\n","export function createInstanceOfClass<T>(c: new () => T, attrValues: any): T {\n  const obj = new c();\n  const keys = Object.keys(attrValues);\n  for (const key of keys) {\n    obj[key] = attrValues[key];\n  }\n  return obj;\n}\n\nexport function clone<T>(obj: T): T {\n  const cloneObj = new (this.constructor() as any)();\n  for (const attr in obj) {\n    if (typeof obj[attr] === 'object') {\n      cloneObj[attr] = clone(obj[attr]);\n    } else {\n      cloneObj[attr] = obj[attr];\n    }\n  }\n  return cloneObj;\n}\n\nexport function setProperty<T, K extends keyof T>(obj: T, key: K, val: any) {\n  return (obj[key] = val);\n}\n\nexport function getProperty<T, K extends keyof T>(obj: T, key: K) {\n  return obj[key];\n}\n\nexport function create<T>(c: new () => T): T {\n  return new c();\n}\n","export * from './object.util';\n\nexport type anyfn = (...args: any[]) => any;\nexport const defer = (fn: anyfn) => {\n  window.setTimeout(fn, 0);\n};\n","import { Injectable } from '@angular/core';\nimport { LoginService } from './login.service';\nimport { first } from 'rxjs/operators';\nimport { environment } from '../environments/env';\nimport { Observable } from 'rxjs';\nimport { rejects, strict } from 'assert';\n\ndeclare var gapi: any;\n\n@Injectable({ providedIn: 'root' })\nexport class DriveService {\n  static readonly defaultFolderName = 'Speecher-Data-Folder';\n  private loginOptions = {\n    key: environment.drive_api_key,\n    clientId: environment.drive_client_id,\n    scope: 'https://www.googleapis.com/auth/drive.appdata',\n    discoveryDocs: [\n      'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest',\n    ],\n  };\n  constructor(private loginService: LoginService) {}\n  createBaseFolder(name?: string): Promise<{ id?: string }> {\n    return new Promise((resolve, reject) => {\n      this.loadGoogleDrive()\n        .then(() => {\n          return this.findFile({ name });\n        })\n        .then((found) => {\n          if (found.IDs.length === 0) {\n            return this.createFolderInternal({ name }).then(resolve);\n          }\n          return resolve({ id: found.IDs[0] });\n        })\n        .catch(reject);\n    });\n  }\n\n  isLoggedIn() {\n    return this.loginService.isLoggedIn({ forScope: this.loginOptions.scope });\n  }\n  /**\n   * Retrieve a list of files belonging to a folder.\n   *\n   * @param folderId ID of the folder to retrieve files from.\n   * @param callback Function to call when the request is complete.\n   *\n   */\n  private allFilesInFolder(\n    folderId: string,\n    callback: (files: { id: string, mimeType: string, name: string }[]) => void\n  ) {\n    const retrievePageOfChildren = (request, result: { id: string, mimeType: string, name: string }[]) => {\n      request.execute((resp) => {\n        result = result.concat(resp.files);\n        const nextPageToken = resp.nextPageToken;\n        if (nextPageToken) {\n          request = gapi.client.drive.files.list({\n            q: \t`${folderId} in parents and trashed = false`,\n            pageToken: nextPageToken,\n            fields: '*'\n          });\n          retrievePageOfChildren(request, result);\n        } else {\n          callback(result);\n        }\n      });\n    };\n    const initialRequest = gapi.client.drive.files.list({\n      q: `'${folderId}' in parents and trashed = false`,\n      fields: 'nextPageToken, files(id, name)',\n      spaces: 'drive',\n    });\n    retrievePageOfChildren(initialRequest, []);\n  }\n\n  fileContent(fileId: string): Promise<{content: string}> {\n    return new Promise((resolve, reject) => {\n      const request = (gapi.client as any).drive.files.get({\n        fileId,\n        alt: 'media',\n      });\n      request.execute((content: any) => {\n          if (content.error) {\n            reject();\n          }\n          resolve({ content });\n      });\n    });\n  }\n\n  allFilesInBaseFolder(): Promise<{ id: string }[]> {\n    return new Promise((resolve, reject) => {\n      this.findFile({name: DriveService.defaultFolderName}).then((folder) => {\n        if (folder.IDs.length !== 0) {\n          return folder.IDs[0];\n        }\n        return '';\n       }).then(id => {\n         if (id === ''){\n           return [];\n         }\n         return this.allFilesInFolder(id, resolve);\n       }).catch(reject);\n    });\n  }\n\n  findFile({\n    id,\n    name,\n  }: {\n    id?: string;\n    name?: string;\n  }): Promise<{ IDs?: string[] }> {\n    let query = '';\n    if (name) {\n      query = `name = '${name}' and trashed = false`;\n    } else if (id) {\n      query = `'${id}' in parents and trashed = false`;\n    }\n\n    return new Promise<{ IDs?: string[] }>((resolve, reject) => {\n      this.loadGoogleDrive()\n        .then(() => {\n          return gapi.client.drive.files.list({\n            // tslint:disable-next-line: quotemark\n            q: query,\n            fields: 'nextPageToken, files(id, name)',\n            spaces: 'drive',\n          });\n        })\n        .then((res) => {\n          const files = res.result && res.result.files ? res.result.files : [];\n          const fileIds: string[] = files.map((file) => file.id);\n          return fileIds;\n        })\n        .then((fileIds) => {\n          resolve({ IDs: fileIds });\n        })\n        .catch(() => {\n          return [];\n        });\n    });\n  }\n\n  login(): Promise<void> {\n    return this.loadGoogleDrive();\n  }\n\n  private loadGoogleDrive(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      if (\n        !this.loginService.isLoggedIn({ forScope: this.loginOptions.scope })\n      ) {\n        this.loginService\n          .login(this.loginOptions)\n          .pipe(first())\n          .subscribe((loggedIn) => {\n            if (loggedIn) {\n              this.loadApi().then(resolve).catch(reject);\n            } else {\n              reject();\n            }\n          });\n        return;\n      }\n      this.loadApi().then(resolve).catch(reject);\n    });\n  }\n\n  private loadApi(): Promise<void> {\n    if (gapi && gapi.client.drive) {\n      return Promise.resolve();\n    }\n    return gapi.client.load('drive', 'v3');\n  }\n\n  private createFolderInternal({\n    name = DriveService.defaultFolderName,\n  }): Promise<{ id?: string }> {\n    const fileMetadata = {\n      name,\n      mimeType: 'application/vnd.google-apps.folder',\n      folderColorRgb: '#007bff',\n    };\n    console.log('Logged in and trying to create folder in drive.');\n    return new Promise((resolve, reject) => {\n      const options = {\n        resource: fileMetadata,\n        fields: 'id',\n      };\n      gapi.client.drive.files.create(options).then((response) => {\n        switch (response.status) {\n          case 200:\n            const file = response.result;\n            console.log('Created file or folder Id: ', file.id);\n            resolve({ id: file.id });\n            break;\n          default:\n            console.log('Error creating the file or folder, ' + response);\n            reject(response);\n            break;\n        }\n      });\n    });\n  }\n\n  logout(): Observable<boolean> {\n    return this.loginService.logout();\n  }\n\n  createFile({\n    name,\n    withContent,\n    folderId,\n  }: {\n    name: string;\n    withContent: any;\n    folderId?: string;\n  }): Promise<{ id: string }> {\n    return new Promise((resolve, reject) => {\n      this.findFile({ name }).then((found) => {\n        if (found.IDs.length !== 0) {\n          return this.createFileWithJSONContent({\n            name,\n            data: JSON.stringify(withContent),\n            fileId: found.IDs[0],\n            update: true,\n          })\n            .then((val) => resolve(val))\n            .catch(() => {\n              console.log('Error: error updating file.');\n              reject();\n            });\n        }\n        return this.createFileWithJSONContent({\n          name,\n          data: JSON.stringify(withContent),\n          parentFolderId: folderId,\n          update: false,\n        })\n          .then((val) => resolve(val))\n          .catch(() => {\n            console.log('Error: error creating file.');\n            reject();\n          });\n      });\n    });\n  }\n\n  private createFileWithJSONContent({\n    name,\n    data,\n    parentFolderId,\n    update,\n    fileId,\n  }: {\n    update: boolean;\n    name: string;\n    data: string;\n    parentFolderId?: string;\n    fileId?: string;\n  }): Promise<{ id: string }> {\n    return new Promise((resolve, reject) => {\n      const boundary = '-------speecher-boundary';\n      const delimiter = '\\r\\n--' + boundary + '\\r\\n';\n      const closeDelim = '\\r\\n--' + boundary + '--';\n\n      const contentType = 'application/json';\n\n      const metadata: any = {\n        name,\n        mimeType: contentType,\n      };\n      if (parentFolderId) {\n        metadata.parents = [parentFolderId];\n      }\n      if (fileId) {\n        console.log(`Updating file in folder id: ${fileId}`);\n      } else {\n        console.log(`Creating file in folder id: ${parentFolderId}`);\n      }\n\n      const multipartRequestBody =\n        delimiter +\n        'Content-Type: application/json\\r\\n\\r\\n' +\n        JSON.stringify(metadata) +\n        delimiter +\n        'Content-Type: ' +\n        contentType +\n        '\\r\\n\\r\\n' +\n        data +\n        closeDelim;\n\n      const urlPath = fileId\n        ? `/upload/drive/v3/files/${fileId}`\n        : `/upload/drive/v3/files`;\n      const request = gapi.client.request({\n        path: urlPath,\n        method: !update ? 'POST' : 'PATCH',\n        params: { uploadType: 'multipart' },\n        headers: {\n          'Content-Type': 'multipart/related; boundary=\"' + boundary + '\"',\n        },\n        body: multipartRequestBody,\n      });\n      request.execute((file) => {\n        if (!file) {\n          return reject();\n        }\n        return resolve({ id: file.id });\n      });\n    });\n  }\n}\n","export const drive = {\n  key: 'AIzaSyDoqtuscz4Pp_xuR9nYO10O-PsouptHmuA',\n  clientId: '814240394039-953g9k1ovucedj8u0aghsj5ofsii5jut.apps.googleusercontent.com'\n};\n"]}